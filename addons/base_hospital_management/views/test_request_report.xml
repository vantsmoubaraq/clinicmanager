<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    
    <record id="paperformat_a5" model="report.paperformat">
        <field name="name">A5</field>
        <field name="default" eval="False"/>
        <field name="format">A5</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">50</field>   <!-- more space for header -->
        <field name="margin_bottom">10</field>
        <field name="margin_left">10</field>
        <field name="margin_right">10</field>
        <field name="dpi">90</field>
    </record>

    <!-- Report Action -->
    <report
        id="action_report_lab_test_request"
        model="lab.test.line"
        string="Request Form"
        report_type="qweb-pdf"
        name="base_hospital_management.report_lab_test_request"
        file="base_hospital_management.report_lab_test_request"
        print_report_name="'Lab Test Request - %s' % (object.patient_id.name if object.patient_id else '')"
        paperformat="base_hospital_management.paperformat_a5"
    />

    <!-- QWeb Template -->
    <template id="report_lab_test_request">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <t t-foreach="docs" t-as="doc">
                    <div class="page">
                        <!-- Title -->
                        <h4 style="text-align:center; font-weight:bold;">REQUEST FORM</h4>
                        <hr/>

                        <!-- Patient Info -->
                        <h5>Patient Information</h5>
                        <p>
                            <strong>Name:</strong> <span t-esc="doc.patient_id.name"/> &#160; &#160; &#160; &#160;
                            <strong>Age:</strong> <span t-esc="doc.patient_id.age"/> &#160; &#160; &#160; &#160;
                            <strong>Sex:</strong> <span t-esc="doc.patient_id.gender"/>  &#160; &#160; &#160; &#160;
                            <strong>Date:</strong> <span t-esc="doc.date"/>  &#160; &#160; &#160; &#160;
                            <strong>Test #:</strong> <span t-esc="doc.id"/>
                        </p>
                        <br/>
                        <br/>

                        <!-- Requested Tests -->
                       
                        <table class="table table-sm table-bordered" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>INVESTIGATIONS TO BE DONE</th>
                                   
                                </tr>
                            </thead>
                            <tbody>
                                   <t t-foreach="doc.test_ids" t-as="test">
                                <tr>
                                    <td><span t-esc="test.name"/></td>
                                    
                                </tr>
                            </t>
                                                </tbody>
                        </table>
                        <br/>
                        <br/>
                        <p><strong>Attending Clinician:</strong> <span t-esc="doc.doctor_id.name"/></p>

                        <!-- Footer -->
                        <br/>
                        <p style="text-align:center; font-size:10px;">
                            This request is generated by Clinic Manager.
                        </p>
                    </div>
                </t>

            </t>
        </t>
    </template>
</odoo>
